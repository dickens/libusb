language: c

git:
    depth: 1

matrix:
    include:
        - os: osx
          osx_image: xcode12.2
          compiler: clang
        - os: osx
          osx_image: xcode11.3
          compiler: clang
        - os: osx
          osx_image: xcode10.1
          compiler: clang

addons:
    apt:
        packages:
            - autoconf
            - automake
            - libtool
            - libudev-dev
            - m4
    homebrew:
        packages:
            - autoconf
            - automake
            - libtool
            - m4

cache:
    directories:
        - $HOME/Library/Caches/Homebrew

before_cache:
    - if [ "$TRAVIS_OS_NAME" = "osx" ]; then brew cleanup; fi

before_script:
    - ./bootstrap.sh

script:
    - if [ "$TRAVIS_OS_NAME" = "linux" ]; then .private/ci-build.sh --build-dir build-netlink -- --disable-udev; fi
    - if [ "$TRAVIS_OS_NAME" = "linux" ]; then .private/ci-build.sh --build-dir build-udev -- --enable-udev; fi
    - if [ "$TRAVIS_OS_NAME" = "osx" ]; then .private/ci-build.sh --build-dir build; fi
    - if [ "$TRAVIS_OS_NAME" = "osx" ]; then cd Xcode && xcodebuild -project libusb.xcodeproj; fi
